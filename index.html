<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <!-- MODIFIED: SEO-optimized title -->
    <title>Is There Light in Nigeria? | Live National Grid Status ‚Äì DiscoWatchNG</title>
    <!-- ADDED: Meta description for SEO -->
    <meta name="description" content="Check Nigeria's national grid status live. See if the grid has collapsed, current power allocation, and real-time DisCo load data. Is there light in your area today?">
    <meta name="keywords" content="is there light, Nigeria grid collapse, national grid Nigeria, NEPA, power supply today, grid status Nigeria, DisCo allocation, electricity distribution Nigeria">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.0/build/global/luxon.min.js"></script>
    <!-- Excel export library -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <!-- ADDED: FAQ Schema for rich search results -->
    <script type="application/ld+json" id="faq-schema">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Is there light in Nigeria today?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Check the live grid status on DiscoWatchNG. Current total power allocation is displayed in real-time, updated from official NIGGRID data twice daily."
          }
        },
        {
          "@type": "Question",
          "name": "Has Nigeria's national grid collapsed?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "A grid collapse is only classified when both morning (8-9am) and evening (6-7pm) readings show sustained 0MW allocations. Short zero readings may be load balancing or switching."
          }
        },
        {
          "@type": "Question",
          "name": "How does Nigeria's national grid work?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Nigeria's grid consists of GenCos (power generation), TCN (transmission), and DisCos (distribution). Power flows from generation companies through transmission lines to distribution companies that supply electricity to consumers."
          }
        }
      ]
    }
    </script>
    <style>
        /* Base Styles for Mobile First */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #1e3a8a;
            --secondary: #3b82f6;
            --accent: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --card-bg: #ffffff;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.1);
            /* ADDED: Status colors */
            --status-stable: #10b981;
            --status-weak: #f59e0b;
            --status-collapse: #ef4444;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.5;
            font-size: 14px;
            -webkit-text-size-adjust: 100%;
            overflow-x: hidden;
            width: 100%;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0.75rem;
            overflow-x: hidden;
        }
        
        /* Header Styles - Mobile First */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo i {
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .logo h1 {
            font-size: 1.2rem;
            line-height: 1.3;
            word-break: break-word;
        }
        
        /* MODIFIED: Header span text */
        .logo span {
            font-weight: 300;
            font-size: 0.75rem;
            opacity: 0.9;
            display: block;
            word-break: break-word;
        }
        
        .header-info {
            text-align: center;
        }
        
        .total-display {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
            word-break: break-word;
        }
        
        .last-updated {
            font-size: 0.75rem;
            opacity: 0.9;
            word-break: break-word;
        }
        
        /* ADDED: Grid Status Indicator - FULLY RESPONSIVE */
        .grid-status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
            padding: 0.5rem;
            background: white;
            border-radius: 40px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            width: 100%;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            padding: 0.4rem 0.8rem;
            border-radius: 30px;
            font-weight: bold;
            color: white;
            font-size: 0.8rem;
            white-space: nowrap;
            flex: 0 1 auto;
        }
        
        @media (max-width: 480px) {
            .status-badge {
                padding: 0.4rem 0.6rem;
                font-size: 0.7rem;
                white-space: normal;
                text-align: center;
                flex: 1 1 auto;
            }
        }
        
        .status-badge.stable {
            background-color: var(--status-stable);
        }
        
        .status-badge.weak {
            background-color: var(--status-weak);
        }
        
        .status-badge.collapse {
            background-color: var(--status-collapse);
        }
        
        .status-badge i {
            font-size: 0.8rem;
        }
        
        .status-label {
            font-size: 0.8rem;
        }
        
        @media (max-width: 480px) {
            .status-label {
                font-size: 0.7rem;
            }
        }
        
        /* ADDED: Hero SEO Section - FULLY RESPONSIVE */
        .hero-seo {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            box-shadow: var(--shadow);
            width: 100%;
            overflow-x: hidden;
        }
        
        .hero-seo h1 {
            color: var(--primary);
            font-size: 1.4rem;
            margin-bottom: 0.75rem;
            line-height: 1.3;
            word-break: break-word;
        }
        
        @media (max-width: 480px) {
            .hero-seo h1 {
                font-size: 1.2rem;
            }
        }
        
        .hero-seo p {
            color: var(--dark);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            word-break: break-word;
        }
        
        /* ADDED: Grid Classification Explainer - FULLY RESPONSIVE */
        .grid-classification {
            background: linear-gradient(135deg, #fff3cd, #ffe69b);
            border-left: 4px solid var(--warning);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.25rem;
            font-size: 0.85rem;
            width: 100%;
            overflow-x: hidden;
            word-break: break-word;
        }
        
        .grid-classification h4 {
            color: #856404;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
            flex-wrap: wrap;
        }
        
        .grid-classification ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .grid-classification li {
            margin-bottom: 0.25rem;
            padding-left: 1.5rem;
            position: relative;
            word-break: break-word;
        }
        
        .grid-classification li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #856404;
        }
        
        /* Grid Status Cards - FULLY RESPONSIVE */
        .grid-status {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
            width: 100%;
        }
        
        @media (min-width: 640px) {
            .grid-status {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .status-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            width: 100%;
            overflow-x: hidden;
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .status-header h3 {
            font-size: 0.9rem;
            color: var(--primary);
            word-break: break-word;
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 0.25rem;
            word-break: break-word;
        }
        
        @media (max-width: 480px) {
            .status-value {
                font-size: 1.3rem;
            }
        }
        
        .status-trend {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            background-color: #d1fae5;
            color: #065f46;
            white-space: nowrap;
        }
        
        @media (max-width: 480px) {
            .status-trend {
                white-space: normal;
                font-size: 0.65rem;
            }
        }
        
        .status-trend.down {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .status-trend.up {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        /* Charts Section - FULLY RESPONSIVE */
        .charts-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
            width: 100%;
        }
        
        @media (min-width: 768px) {
            .charts-section {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .chart-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--shadow);
            height: auto;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            width: 100%;
            overflow-x: hidden;
        }
        
        .chart-card h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.95rem;
            word-break: break-word;
        }
        
        .chart-subtitle {
            font-size: 0.7rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
            word-break: break-word;
        }
        
        .chart-container {
            flex: 1;
            position: relative;
            min-height: 180px;
            width: 100%;
        }
        
        canvas {
            max-width: 100%;
            height: auto !important;
            width: 100% !important;
        }
        
        /* ADDED: Chart Explainers - FULLY RESPONSIVE */
        .chart-explainer {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 8px;
            font-size: 0.75rem;
            color: var(--gray);
            border-left: 3px solid var(--secondary);
            word-break: break-word;
        }
        
        /* ADDED: FAQ Section - FULLY RESPONSIVE */
        .faq-section {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            box-shadow: var(--shadow);
            width: 100%;
            overflow-x: hidden;
        }
        
        .faq-section h2 {
            color: var(--primary);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            word-break: break-word;
        }
        
        @media (max-width: 480px) {
            .faq-section h2 {
                font-size: 1.1rem;
            }
        }
        
        .faq-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.25rem;
            width: 100%;
        }
        
        @media (min-width: 768px) {
            .faq-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .faq-item {
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 1.25rem;
            width: 100%;
        }
        
        .faq-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .faq-question {
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            word-break: break-word;
        }
        
        .faq-question i {
            color: var(--secondary);
            flex-shrink: 0;
            margin-top: 0.2rem;
        }
        
        .faq-answer {
            color: var(--gray);
            font-size: 0.85rem;
            line-height: 1.5;
            padding-left: 1.75rem;
            word-break: break-word;
        }
        
        @media (max-width: 480px) {
            .faq-answer {
                padding-left: 1.5rem;
                font-size: 0.8rem;
            }
        }
        
        .faq-answer strong {
            color: var(--primary);
        }
        
        /* ADDED: Grid Education - FULLY RESPONSIVE */
        .grid-education {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            border: 1px solid #bae6fd;
            width: 100%;
            overflow-x: hidden;
        }
        
        .grid-education h3 {
            color: #0369a1;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            word-break: break-word;
        }
        
        .grid-flow {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin: 1.25rem 0;
            width: 100%;
        }
        
        .grid-flow-item {
            flex: 1 1 120px;
            min-width: 100px;
            text-align: center;
            padding: 0.75rem 0.5rem;
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }
        
        @media (max-width: 600px) {
            .grid-flow-item {
                flex: 1 1 calc(50% - 0.5rem);
                min-width: calc(50% - 0.5rem);
            }
            
            .grid-flow-arrow {
                display: none;
            }
        }
        
        .grid-flow-item i {
            font-size: 1.3rem;
            color: var(--secondary);
            margin-bottom: 0.25rem;
        }
        
        .grid-flow-item span {
            display: block;
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--primary);
            word-break: break-word;
        }
        
        .grid-flow-item small {
            display: block;
            font-size: 0.65rem;
            color: var(--gray);
            word-break: break-word;
        }
        
        .grid-flow-arrow {
            color: var(--gray);
            font-size: 1.2rem;
        }
        
        /* Data Table - FULLY RESPONSIVE */
        .data-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            width: 100%;
            overflow-x: hidden;
        }
        
        .data-section h3 {
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            word-break: break-word;
        }
        
        @media (min-width: 640px) {
            .data-section h3 {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .table-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 0.75rem;
            width: 100%;
        }
        
        .table-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .table-container {
            overflow-x: auto;
            overflow-y: auto;
            max-height: 500px;
            -webkit-overflow-scrolling: touch;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
            min-width: 800px;
        }
        
        th {
            background-color: #f1f5f9;
            color: var(--primary);
            font-weight: 600;
            text-align: left;
            padding: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap;
            font-size: 0.7rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td {
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.7rem;
            white-space: nowrap;
        }
        
        .low-grid {
            background-color: #fef2f2;
        }
        
        .peak-grid {
            background-color: #f0f9ff;
        }
        
        /* Public Notice - MODIFIED text, FULLY RESPONSIVE */
        .public-notice {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            border: 1px solid #bae6fd;
            text-align: center;
            width: 100%;
            overflow-x: hidden;
        }
        
        .public-notice h3 {
            color: #0369a1;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            font-size: 1.1rem;
            word-break: break-word;
        }
        
        .public-notice p {
            color: #0c4a6e;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            word-break: break-word;
        }
        
        /* Contact Section - FULLY RESPONSIVE */
        .contact-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            text-align: center;
            width: 100%;
            overflow-x: hidden;
        }
        
        .contact-section h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            word-break: break-word;
        }
        
        .contact-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.25rem;
            width: 100%;
        }
        
        @media (min-width: 640px) {
            .contact-buttons {
                flex-direction: row;
                justify-content: center;
            }
        }
        
        button {
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-size: 0.85rem;
            width: 100%;
            word-break: break-word;
        }
        
        @media (min-width: 640px) {
            button {
                width: auto;
                min-width: 200px;
            }
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e40af;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background-color: #e2e8f0;
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #0da271;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background-color: #f59e0b;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d97706;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-excel {
            background-color: #217346;
            color: white;
        }
        
        .btn-excel:hover {
            background-color: #1a5d38;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .contact-info {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            font-size: 0.8rem;
            color: var(--gray);
            line-height: 1.5;
            word-break: break-word;
        }
        
        .contact-info strong {
            color: var(--primary);
        }
        
        /* Footer - FULLY RESPONSIVE */
        footer {
            text-align: center;
            padding: 1.25rem;
            color: var(--gray);
            font-size: 0.75rem;
            border-top: 1px solid #e2e8f0;
            margin-top: 1rem;
            line-height: 1.6;
            width: 100%;
            overflow-x: hidden;
        }
        
        footer p {
            margin-bottom: 0.5rem;
            word-break: break-word;
        }
        
        footer strong {
            color: var(--primary);
        }
        
        /* Loader */
        .loader {
            display: none;
            text-align: center;
            padding: 1.5rem;
        }
        
        .loader.active {
            display: block;
        }
        
        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 0.75rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            padding: 0.75rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            max-width: 40%;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        .notification.success {
            border-left: 4px solid var(--accent);
        }
        
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning);
        }
        
        .notification.info {
            border-left: 4px solid var(--secondary);
        }
        
        .notification i {
            font-size: 1.2rem;
        }
        
        .notification.success i {
            color: var(--accent);
        }
        
        .notification.error i {
            color: var(--danger);
        }
        
        .notification.warning i {
            color: var(--warning);
        }
        
        .notification.info i {
            color: var(--secondary);
        }
        
        .notification span {
            flex: 1;
            font-size: 0.85rem;
            color: var(--dark);
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-close:hover {
            color: var(--dark);
        }
        
        /* Record count */
        .record-count {
            font-size: 0.75rem;
            color: var(--gray);
            text-align: center;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 4px;
            word-break: break-word;
        }
        
        /* Tablet and Desktop breakpoints - already handled in responsive styles above */
        @media (min-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .logo h1 {
                font-size: 1.5rem;
            }
            
            .logo span {
                font-size: 0.85rem;
            }
            
            .header-info {
                text-align: right;
            }
            
            .total-display {
                font-size: 1.6rem;
            }
            
            .last-updated {
                font-size: 0.8rem;
            }
            
            .hero-seo h1 {
                font-size: 1.8rem;
            }
            
            .status-value {
                font-size: 1.8rem;
            }
            
            .status-trend {
                font-size: 0.8rem;
            }
            
            .faq-section h2 {
                font-size: 1.3rem;
            }
        }
        
        @media (min-width: 1024px) {
            .status-value {
                font-size: 2rem;
            }
        }

        /* NEW: Analytics Cards Styling */
        .analytics-section {
            margin-bottom: 1rem;
        }

        .analytics-section h3 {
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        @media (min-width: 640px) {
            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .analytics-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .analytics-card {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .analytics-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            color: var(--primary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .analytics-header i {
            font-size: 1rem;
        }

        .analytics-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .analytics-subtext {
            font-size: 0.75rem;
            color: var(--gray);
            line-height: 1.4;
        }

        .comparison-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .comparison-badge.positive {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--accent);
        }

        .comparison-badge.negative {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .comparison-badge.neutral {
            background-color: rgba(100, 116, 139, 0.1);
            color: var(--gray);
        }

        /* NEW: Chart Container Styling for new charts */
        .new-chart-container {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        .new-chart-header {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        @media (min-width: 640px) {
            .new-chart-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .new-chart-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .chart-selector {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.85rem;
            background-color: white;
            cursor: pointer;
        }

        @media (min-width: 640px) {
            .chart-selector {
                width: auto;
                min-width: 200px;
            }
        }

        .new-chart-canvas-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        @media (min-width: 640px) {
            .new-chart-canvas-wrapper {
                height: 350px;
            }
        }

        @media (min-width: 1024px) {
            .new-chart-canvas-wrapper {
                height: 400px;
            }
        }

        /* NEW: Share Buttons */
        .share-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .share-btn {
            flex: 1;
            min-width: 120px;
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: white;
            transition: all 0.2s;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .share-btn.twitter {
            background-color: #1DA1F2;
        }

        .share-btn.facebook {
            background-color: #1877F2;
        }

        .share-btn.whatsapp {
            background-color: #25D366;
        }

        .share-btn.linkedin {
            background-color: #0A66C2;
        }

        .share-btn.copy {
            background-color: var(--gray);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-bolt"></i>
                <div>
                    <h1>DiscoWatchNG Dashboard</h1>
                    <!-- MODIFIED: Repositioned messaging -->
                    <span>Nigeria's Live Grid Status Checker</span>
                </div>
            </div>
            <div class="header-info">
                <div class="total-display" id="current-total">Loading...</div>
                <div class="last-updated" id="last-updated">Last updated: Loading...</div>
            </div>
        </header>
        
        <!-- ADDED: SEO Hero Section with H1 - FULLY RESPONSIVE -->
        <div class="hero-seo">
            <h1>Is There Light in Nigeria Right Now?</h1>
            <p>Check Nigeria's national grid status live. See if the grid has collapsed or is online, view current power allocation, and track real-time DisCo load data. Updated twice daily from official NIGGRID sources.</p>
        </div>
        
        <!-- ADDED: Grid Status Visual Indicator - FULLY RESPONSIVE -->
        <div class="grid-status-indicator" id="grid-status-indicator">
            <span id="status-badge" class="status-badge stable" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <span class="status-label">Grid Stable</span>
            </span>
            <span id="status-badge-weak" class="status-badge weak" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <span class="status-label">Grid Weak</span>
            </span>
            <span id="status-badge-collapse" class="status-badge collapse" style="display: none;">
                <i class="fas fa-times-circle"></i>
                <span class="status-label">Grid Collapsed</span>
            </span>
        </div>
        
        <!-- ADDED: Grid Collapse Classification Explainer - CRITICAL PR, FULLY RESPONSIVE -->
        <div class="grid-classification">
            <h4><i class="fas fa-info-circle"></i> How We Determine Grid Collapse</h4>
            <p><strong>Important:</strong> 0MW readings, even for short hours may be temporary load balancing or switching. We only classify a collapse when:</p>
            <ul>
                <li><strong>Morning (8‚Äì9am)</strong> AND</li>
                <li><strong>Evening (6‚Äì7pm)</strong></li>
            </ul>
            <p>(an almost 12-hour period) both show <strong>sustained 0MW allocations</strong>. Short periods (a few hours) of zero readings alone do not indicate a national grid collapse.</p>
            <p style="margin-top: 0.5rem; font-style: italic;">This transparent methodology ensures accurate reporting.</p>
        </div>
        
        <!-- MODIFIED: Public Notice text - FULLY RESPONSIVE -->
        <div class="public-notice">
            <h3><i class="fas fa-eye"></i> Nigeria's Live Grid Status Checker</h3>
            <p>DiscoWatchNG monitors Nigeria's electricity distribution in real-time. Get instant answers to: <strong>"Is there light?"</strong> and <strong>"Has the grid collapsed?"</strong></p>
            <p>Data is automatically collected and databased from official NIGGRID sources twice daily (morning and evening).</p>
        </div>
        
        <div class="grid-status">
            <div class="status-card">
                <div class="status-header">
                    <h3>Current DisCo Load</h3>
                    <div class="status-trend" id="grid-trend">Loading...</div>
                </div>
                <div class="status-value" id="grid-status-value">Loading...</div>
                <!-- MODIFIED: More descriptive text -->
                <p style="font-size: 0.8rem;">Total power allocated to all DisCos. <strong>Is there light today?</strong> Check this number.</p>
            </div>
            
            <div class="status-card">
                <div class="status-header">
                    <h3>Peak Load Today</h3>
                    <div class="status-trend" id="peak-trend">Today</div>
                </div>
                <div class="status-value" id="peak-load">Loading...</div>
                <!-- MODIFIED: More descriptive text -->
                <p style="font-size: 0.8rem;">Highest recorded grid allocation catalogued on our logs today.</p>
            </div>
            
            <div class="status-card">
                <div class="status-header">
                    <h3>Average per DisCo</h3>
                    <div class="status-trend" id="average-trend">Latest Reading</div>
                </div>
                <div class="status-value" id="average-load">Loading...</div>
                <!-- MODIFIED: More descriptive text -->
                <p style="font-size: 0.8rem;">Average power per distribution company. Lower numbers (from 0MW to 270MW) show a weak grid.</p>
            </div>
        </div>
        
        <!-- NEW: Advanced Analytics Section -->
        <div class="analytics-section">
            <h3><i class="fas fa-chart-bar"></i> Advanced Analytics</h3>
            <div class="analytics-grid">
                <!-- Day-on-Day Comparison -->
                <div class="analytics-card">
                    <div class="analytics-header">
                        <i class="fas fa-calendar-day"></i>
                        <span>Day-on-Day Change</span>
                    </div>
                    <div class="analytics-value" id="dod-change">-</div>
                    <div class="analytics-subtext" id="dod-subtext">Comparing latest reading with previous day</div>
                    <div class="comparison-badge" id="dod-badge" style="display: none;">
                        <i class="fas fa-arrow-up"></i>
                        <span id="dod-percentage">-</span>
                    </div>
                </div>

                <!-- Capacity Utilization -->
                <div class="analytics-card">
                    <div class="analytics-header">
                        <i class="fas fa-battery-three-quarters"></i>
                        <span>Capacity Utilization</span>
                    </div>
                    <div class="analytics-value" id="capacity-ratio">-</div>
                    <div class="analytics-subtext" id="capacity-subtext">Current generation vs installed capacity</div>
                    <div class="comparison-badge neutral" id="capacity-badge" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <span id="capacity-percentage">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="charts-section">
            <div class="chart-card">
                <h3>Nigeria Grid Load Over Time (MW)</h3>
                <div class="chart-subtitle">Last 15 readings - Shows grid stability trends</div>
                <div class="chart-container">
                    <canvas id="loadChart"></canvas>
                </div>
                <!-- ADDED: Chart Explainer - FULLY RESPONSIVE -->
                <div class="chart-explainer">
                    <strong>üìà What this shows:</strong> Historical grid performance. Sharp drops to 0MW in consecutive readings may indicate a <strong>national grid collapse</strong>.
                </div>
            </div>
            
            <div class="chart-card">
                <h3>DisCo Allocation Breakdown (MW)</h3>
                <div class="chart-subtitle">Current power distribution by company</div>
                <div class="chart-container">
                    <canvas id="discoChart"></canvas>
                </div>
                <!-- ADDED: Chart Explainer - FULLY RESPONSIVE -->
                <div class="chart-explainer">
                    <strong>üè¢ What this shows:</strong> How much power each DisCo is receiving. Uneven distribution can explain <strong>why some areas have light while others don't</strong>.
                </div>
            </div>
        </div>
        
        <!-- NEW: DisCo Trendline Chart -->
        <div class="new-chart-container">
            <div class="new-chart-header">
                <div class="new-chart-title">
                    <i class="fas fa-chart-line"></i>
                    <span>DisCo Load Trend (Last 12 Readings)</span>
                </div>
                <select class="chart-selector" id="disco-trend-selector">
                    <option value="">Select a DisCo</option>
                </select>
            </div>
            <div class="new-chart-canvas-wrapper">
                <canvas id="disco-trend-chart"></canvas>
            </div>
            <div class="chart-explainer">
                <strong>üìà Understanding the Trend:</strong> This chart shows the power allocation history for the selected distribution company over the last 12 recorded readings. Use this to identify patterns, peak allocation times, and overall supply consistency to your DisCo.
            </div>
        </div>

        <!-- NEW: DisCo Min/Max Comparison Chart -->
        <div class="new-chart-container">
            <div class="new-chart-header">
                <div class="new-chart-title">
                    <i class="fas fa-signal"></i>
                    <span>DisCo Performance Range</span>
                </div>
                <select class="chart-selector" id="disco-range-selector">
                    <option value="">Select a DisCo</option>
                </select>
            </div>
            <div class="new-chart-canvas-wrapper">
                <canvas id="disco-range-chart"></canvas>
            </div>
            <div class="chart-explainer">
                <strong>üìä What This Shows:</strong> Compare the current allocation with the historical minimum and maximum values (excluding zero readings) for the selected DisCo. This helps you understand if your current power supply is closer to typical highs or lows, and reveals the full operating range of each distribution company.
            </div>
        </div>
        
        <!-- ADDED: FAQ Section - SEO Powerhouse, FULLY RESPONSIVE -->
        <div class="faq-section">
            <h2><i class="fas fa-question-circle"></i> Frequently Asked Questions About Nigeria's Grid</h2>
            <div class="faq-grid">
                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-bolt"></i> Q1: Is There Light in Nigeria Today?
                    </div>
                    <div class="faq-answer">
                        <strong>A:</strong> Check the <strong>grid status indicator</strong> above. Current total power allocation is <strong><span id="faq-total">Loading...</span></strong> as of <span id="faq-time">Loading...</span>. If this number is above 0MW, the grid is operational.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-exclamation-triangle"></i> Q2: Has Nigeria's National Grid Collapsed?
                    </div>
                    <div class="faq-answer">
                        <strong>A:</strong> Based on our classification methodology, a collapse is only confirmed when <strong>both morning AND evening readings show sustained 0MW allocations</strong>. Current collapse status: <strong><span id="faq-collapse">Checking...</span></strong>.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-gas-pump"></i> Q3: Why Do GenCos Report Low Gas and Power Supply?
                    </div>
                    <div class="faq-answer">
                        <strong>A:</strong> Generation companies (GenCos) often face <strong>gas supply shortages, pipeline vandalism, or maintenance issues</strong>. This directly reduces power available to the national grid. Check <a href="https://cryptonian0xx.github.io/GencoWatchNG/" target="_blank" style="color: var(--primary);">GencoWatchNG</a> for generation data.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-network-wired"></i> Q4: How Does Nigeria's National Grid Work?
                    </div>
                    <div class="faq-answer">
                        <strong>A:</strong> Nigeria's grid operates on three levels: <strong>GenCos</strong> generate power, <strong>TCN</strong> transmits it through national lines, and <strong>DisCos</strong> distribute to consumers. When any part fails, it affects the entire system. See the visual breakdown below.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ADDED: How Nigeria Grid Works - Educational Content, FULLY RESPONSIVE -->
        <div class="grid-education">
            <h3><i class="fas fa-graduation-cap"></i> Understanding Nigeria's National Grid</h3>
            <p style="margin-bottom: 1rem; color: #0c4a6e;">The national grid is a complex system. Here's how power gets from generation to your home:</p>
            
            <div class="grid-flow">
                <div class="grid-flow-item">
                    <i class="fas fa-industry"></i>
                    <span>GenCos</span>
                    <small>Generate Power</small>
                </div>
                <div class="grid-flow-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="grid-flow-item">
                    <i class="fas fa-tower-broadcast"></i>
                    <span>TCN</span>
                    <small>Transmission</small>
                </div>
                <div class="grid-flow-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="grid-flow-item">
                    <i class="fas fa-building"></i>
                    <span>DisCos</span>
                    <small>Distribution</small>
                </div>
                <div class="grid-flow-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="grid-flow-item">
                    <i class="fas fa-home"></i>
                    <span>Consumers</span>
                    <small>You</small>
                </div>
            </div>
            
            <p style="margin-top: 1rem; font-size: 0.85rem; background: white; padding: 0.75rem; border-radius: 8px;">
                <strong>üîç Why this matters:</strong> When you ask <em>"has the grid collapsed?"</em> or <em>"is there light?"</em>, you're checking the entire chain. A collapse means power stops at the transmission stage.
            </p>
        </div>
        
        <div class="data-section">
            <h3>
                <div class="table-header">
                    <span>All DisCo Allocation Data - Official NIGGRID</span>
                    <div class="table-actions">
                        <button class="btn-excel" id="download-excel">
                            <i class="fas fa-file-excel"></i> Download Excel
                        </button>
                        <button class="btn-secondary" id="refresh-data">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                    </div>
                </div>
            </h3>
            <div class="loader" id="table-loader">
                <div class="spinner"></div>
                <p>Loading all data from Google Sheets...</p>
            </div>
            <div class="table-container" id="table-container">
                <table id="grid-data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Abuja</th>
                            <th>Eko</th>
                            <th>Ikeja</th>
                            <th>Ibadan</th>
                            <th>Benin</th>
                            <th>Enugu</th>
                            <th>PHarcourt</th>
                            <th>Kaduna</th>
                            <th>Jos</th>
                            <th>Yola</th>
                            <th>Kano</th>
                            <th>Total</th>
                            <th>Time of Day</th>
                            <th>Grid Status</th>
                        </tr>
                    </thead>
                    <tbody id="grid-data-body">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
            <div class="record-count" id="record-count">
                Loading records...
            </div>
        </div>
        
        <div class="contact-section">
            <h3><i class="fas fa-envelope"></i> Contact & Collaboration</h3>
            <p style="color: var(--gray); margin-bottom: 1.5rem; font-size: 0.85rem;">
                For inquiries, data verification, or collaboration opportunities
            </p>
            
            <div class="contact-buttons">
                <!-- MODIFIED: Updated email address -->
                <button class="btn-success" id="email-button">
                    <i class="fas fa-envelope"></i> Email for Inquiries
                </button>
                <button class="btn-warning" id="admin-request-button">
                    <i class="fas fa-external-link-alt"></i> Visit GencoWatch
                </button>
            </div>
            
            <!-- NEW: Social Media Share Buttons -->
            <div class="share-section" style="margin-top: 1.5rem;">
                <h4 style="font-size: 0.9rem; color: var(--gray); margin-bottom: 0.75rem;">
                    <i class="fas fa-share-alt"></i> Share DiscoWatchNG
                </h4>
                <div class="share-buttons">
                    <!-- Native share button (shows only on supported devices) -->
                    <button class="share-btn" id="share-native" style="background-color: #6366f1; display: none;">
                        <i class="fas fa-share-nodes"></i> Share
                    </button>
                    <button class="share-btn twitter" id="share-twitter">
                        <i class="fab fa-twitter"></i> Twitter
                    </button>
                    <button class="share-btn facebook" id="share-facebook">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                    <button class="share-btn whatsapp" id="share-whatsapp">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                    <button class="share-btn linkedin" id="share-linkedin">
                        <i class="fab fa-linkedin-in"></i> LinkedIn
                    </button>
                    <button class="share-btn copy" id="share-copy">
                        <i class="fas fa-link"></i> Copy Link
                    </button>
                </div>
            </div>
            
            <div class="contact-info">
                <!-- MODIFIED: Added PR disclaimer -->
                <p><strong>üìä About this data:</strong> While we strive for accuracy, grid data may have reporting delays. We do not sensationalize - our collapse classification requires <strong>sustained 0MW in both daily readings</strong>.</p>
                <p style="margin-top: 0.5rem;">Please use the buttons above to reach out for queries, data verification, or future collaborations.</p>
            </div>
        </div>
        
        <footer>
            <p>Built by <strong>Mundez</strong> for <strong>MDZ Concepts</strong></p>
            <!-- MODIFIED: Added SEO keywords -->
            <p><strong>DiscoWatchNG</strong> - Answering "Is there light in Nigeria?" with real-time grid data. We track DisCo allocations to determine national grid status, collapses, and power distribution trends.</p>
            <p>For generation data and power station monitoring, visit GencoWatchNG. Data is automatically updated from official sources twice daily (Morning and Evening).</p>
            <!-- ADDED: Keyword footer for SEO -->
            <p style="margin-top: 0.75rem; font-size: 0.65rem; color: #94a3b8;">Keywords: Nigeria grid status today, is there light, grid collapse news, NEPA, power supply, DisCo allocation, national grid Nigeria, electricity distribution</p>
        </footer>
    </div>

    <script>
        // ============================================
        // GOOGLE SHEETS CONFIGURATION - UPDATED TO NEW SHEET
        // ============================================
        const GOOGLE_SHEET_ID = '1zDXVSrHfXf97nwMkUTWyPQLpaE1HU9n_XQYUFMLDXSk';
        const SHEET_NAME = 'Sheet1';
        const OPENSHEET_URL = `https://opensheet.elk.sh/${GOOGLE_SHEET_ID}/${SHEET_NAME}`;
        const DateTime = luxon.DateTime;

        // ============================================
        // GOOGLE SHEETS API CLASS (Updated for new sheet)
        // ============================================
        class GoogleSheetsAPI {
            constructor(baseUrl) {
                this.baseUrl = baseUrl;
            }
            
            async fetchAllData() {
                console.log('Fetching data from:', this.baseUrl);
                
                try {
                    const response = await fetch(this.baseUrl);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log('Data loaded successfully:', data);
                    
                    return {
                        success: true,
                        records: data
                    };
                } catch (error) {
                    console.error('Error fetching data:', error);
                    return {
                        success: false,
                        message: error.message,
                        records: []
                    };
                }
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        const api = new GoogleSheetsAPI(OPENSHEET_URL);
        let gridData = [];
        let loadChart = null;
        let discoChart = null;
        let discoTrendChart = null; // NEW
        let discoRangeChart = null; // NEW
        let realtimeTotal = 0; // Real-time total from OpenSheet API
        
        // NEW: Constants for analytics
        const INSTALLED_CAPACITY_MW = 13625; // Based on official NERC data from August 2025
        const DISCO_NAMES = ['Abuja', 'Eko', 'Ikeja', 'Ibadan', 'Benin', 'Enugu', 'PHarcourt', 'Kaduna', 'Jos', 'Yola', 'Kano'];
        
        // Helper function to get Abuja value (handles both field name variations)
        function getAbujaValue(row) {
            return parseInt(row.AbuyaDisCo || row.AbujaDisCo || 0);
        }
        
        const DISCO_FIELD_MAP = {
            'Abuja': 'AbuyaDisCo',  // NOTE: API sometimes uses "Abuya" or "Abuja"
            'Eko': 'EkoDisCo',
            'Ikeja': 'IkejaDisCo',
            'Ibadan': 'IbadanDisCo',
            'Benin': 'BeninDisCo',
            'Enugu': 'EnuguDisCo',
            'PHarcourt': 'PHarcourtDisCo',
            'Kaduna': 'KadunaDisCo',
            'Jos': 'JosDisCo',
            'Yola': 'YolaDisCo',
            'Kano': 'KanoDisCo'
        };
        
        // Function to fetch real-time total MW from OpenSheet
        async function fetchRealtimeTotal() {
            try {
                const response = await fetch('https://opensheet.elk.sh/1zDXVSrHfXf97nwMkUTWyPQLpaE1HU9n_XQYUFMLDXSk/LiveMW');
                const data = await response.json();
                if (data && data.length > 0 && data[0].Total_MW) {
                    realtimeTotal = parseInt(data[0].Total_MW) || 0;
                    console.log('Real-time total fetched:', realtimeTotal, 'MW');
                    return realtimeTotal;
                }
            } catch (error) {
                console.error('Error fetching real-time total:', error);
            }
            return realtimeTotal;
        }

        // DOM Elements
        const gridDataBody = document.getElementById('grid-data-body');
        const currentTotal = document.getElementById('current-total');
        const lastUpdated = document.getElementById('last-updated');
        const gridStatusValue = document.getElementById('grid-status-value');
        const gridTrend = document.getElementById('grid-trend');
        const peakLoad = document.getElementById('peak-load');
        const peakTrend = document.getElementById('peak-trend');
        const averageLoad = document.getElementById('average-load');
        const averageTrend = document.getElementById('average-trend');
        const tableLoader = document.getElementById('table-loader');
        const refreshButton = document.getElementById('refresh-data');
        const downloadExcelButton = document.getElementById('download-excel');
        const recordCount = document.getElementById('record-count');
        const tableContainer = document.getElementById('table-container');
        const emailButton = document.getElementById('email-button');
        const adminRequestButton = document.getElementById('admin-request-button');
        
        // ADDED: New DOM Elements for SEO/FAQ
        const faqTotal = document.getElementById('faq-total');
        const faqTime = document.getElementById('faq-time');
        const faqCollapse = document.getElementById('faq-collapse');
        const statusBadge = document.getElementById('status-badge');
        const statusBadgeWeak = document.getElementById('status-badge-weak');
        const statusBadgeCollapse = document.getElementById('status-badge-collapse');

        // NEW: Analytics DOM elements
        const dodChange = document.getElementById('dod-change');
        const dodSubtext = document.getElementById('dod-subtext');
        const dodBadge = document.getElementById('dod-badge');
        const dodPercentage = document.getElementById('dod-percentage');
        const capacityRatio = document.getElementById('capacity-ratio');
        const capacitySubtext = document.getElementById('capacity-subtext');
        const capacityBadge = document.getElementById('capacity-badge');
        const capacityPercentage = document.getElementById('capacity-percentage');
        
        // NEW: Chart selectors
        const discoTrendSelector = document.getElementById('disco-trend-selector');
        const discoRangeSelector = document.getElementById('disco-range-selector');

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DiscoWatchNG Dashboard initialized');
            
            // Set up event listeners
            refreshButton.addEventListener('click', loadDataFromSheets);
            downloadExcelButton.addEventListener('click', downloadTableToExcel);
            
            // Contact button event listeners - MODIFIED email
            emailButton.addEventListener('click', function() {
                const subject = encodeURIComponent('DiscoWatchNG - Inquiry');
                const body = encodeURIComponent('Hello,\n\nI would like to inquire about DiscoWatchNG (Nigeria DisCo Monitoring Dashboard).\n\n[Please provide details of your inquiry here]');
                window.open(`mailto:edmundezie@gmail.com?subject=${subject}&body=${body}`, '_blank');
                showNotification('Opening email client...', 'info');
            });
            
            adminRequestButton.addEventListener('click', function() {
                window.open('https://cryptonian0xx.github.io/GencoWatchNG/', '_blank');
                showNotification('Opening GencoWatch...', 'info');
            });
            
            // NEW: Populate disco selectors
            populateDiscoSelectors();
            
            // NEW: Chart selector event listeners
            discoTrendSelector.addEventListener('change', updateDiscoTrendChart);
            discoRangeSelector.addEventListener('change', updateDiscoRangeChart);
            
            // NEW: Share button event listeners
            setupShareButtons();
            
            // Load initial data
            loadDataFromSheets();
            
            // Auto-refresh data every 2 minutes
            setInterval(() => {
                loadDataFromSheets();
                showNotification('Auto-refreshed data', 'info');
            }, 120000);
        });

        // ============================================
        // EXCEL DOWNLOAD FUNCTION
        // ============================================
        function downloadTableToExcel() {
            if (gridData.length === 0) {
                showNotification('No data available to download', 'error');
                return;
            }
            
            try {
                // Create workbook
                const wb = XLSX.utils.book_new();
                
                // Prepare data for export (using the same order as displayed in table)
                const exportData = gridData.map(record => {
                    return {
                        'Date': record.Date || '',
                        'Time': fixTimeFormat(record.Time || '', record.Timeofday || ''),
                        'Abuja': formatNumber(record.AbuyaDisCo || record.AbujaDisCo || 0),
                        'Eko': formatNumber(record.EkoDisCo || 0),
                        'Ikeja': formatNumber(record.IkejaDisCo || 0),
                        'Ibadan': formatNumber(record.IbadanDisCo || 0),
                        'Benin': formatNumber(record.BeninDisCo || 0),
                        'Enugu': formatNumber(record.EnuguDisCo || 0),
                        'PHarcourt': formatNumber(record.PHarcourtDisCo || 0),
                        'Kaduna': formatNumber(record.KadunaDisCo || 0),
                        'Jos': formatNumber(record.JosDisCo || 0),
                        'Yola': formatNumber(record.YolaDisCo || 0),
                        'Kano': formatNumber(record.KanoDisCo || 0),
                        'Total': formatNumber(record.Total || 0),
                        'Time of Day': record.Timeofday || '',
                        'Grid Status': record.Grid_status || ''
                    };
                });
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(exportData);
                
                // Add title and metadata
                const title = `Nigeria DisCo Allocation Data - Exported on ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`;
                XLSX.utils.sheet_add_aoa(ws, [[title]], { origin: -1 });
                
                // Add workbook properties
                wb.Props = {
                    Title: "Nigeria DisCo Allocation Data",
                    Subject: "Distribution Company Power Allocation Data",
                    Author: "DiscoWatchNG Dashboard",
                    CreatedDate: new Date()
                };
                
                // Add worksheet to workbook
                XLSX.utils.book_append_sheet(wb, ws, "DisCo Data");
                
                // Generate filename
                const filename = `Nigeria_DisCo_Data_${new Date().toISOString().slice(0,10)}.xlsx`;
                
                // Save file
                XLSX.writeFile(wb, filename);
                
                showNotification(`‚úÖ Excel file downloaded: ${filename}`, 'success');
                
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showNotification('‚ùå Error downloading Excel file', 'error');
            }
        }

        // ============================================
        // DATE/TIME FIXING FUNCTIONS
        // ============================================
        function fixTimeFormat(timeString, timeOfDay) {
            if (!timeString) return '';
            
            let hours, minutes;
            
            // Extract time parts
            if (/^\d{1,2}:\d{2}:\d{2}$/.test(timeString)) {
                // Has seconds, remove them
                const parts = timeString.split(':');
                hours = parseInt(parts[0]);
                minutes = parts[1];
            } else if (/^\d{1,2}:\d{2}$/.test(timeString)) {
                // Already in HH:MM format
                const parts = timeString.split(':');
                hours = parseInt(parts[0]);
                minutes = parts[1];
            } else {
                // Try to extract HH:MM from any string
                const timeMatch = timeString.match(/(\d{1,2}):(\d{2})/);
                if (timeMatch) {
                    hours = parseInt(timeMatch[1]);
                    minutes = timeMatch[2];
                } else {
                    return timeString;
                }
            }
            
            // Convert to 24-hour format based on Time of Day
            if (timeOfDay) {
                const tod = timeOfDay.toLowerCase();
                
                // Evening or Night means PM (add 12 to hours 1-11, keep 12 as is)
                if ((tod === 'evening' || tod === 'night') && hours < 12) {
                    hours += 12;
                }
                // Morning or Afternoon with hour 12 means it should stay as is for noon
                // or be converted to 00 for midnight
                else if ((tod === 'morning' || tod === 'afternoon') && hours === 12) {
                    // 12 AM (midnight) in morning context
                    if (tod === 'morning') {
                        hours = 0;
                    }
                    // 12 PM (noon) stays as 12 in afternoon
                }
            }
            
            // Format with leading zeros
            const hoursStr = String(hours).padStart(2, '0');
            const minutesStr = String(minutes).padStart(2, '0');
            
            return `${hoursStr}:${minutesStr}`;
        }

        function formatDateForDisplay(dateString) {
            if (!dateString) return '';
            
            // Handle different date formats
            if (dateString.includes('/')) {
                // Already in DD/MM/YYYY format
                return dateString;
            }
            
            let date;
            if (dateString.includes('T')) {
                // ISO format like "2025-12-16T23:00:00.000Z"
                date = new Date(dateString);
            } else {
                // Simple format like "2025-12-16"
                date = new Date(dateString + 'T00:00:00');
            }
            
            // Format as DD/MM/YYYY
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            
            return `${day}/${month}/${year}`;
        }

        // ============================================
        // SORTING FUNCTIONS
        // ============================================
        function sortDataNewestFirst(data) {
            return [...data].sort((a, b) => {
                // Create Date objects for comparison
                const dateA = parseDateTime(a);
                const dateB = parseDateTime(b);
                return dateB - dateA; // Newest first
            });
        }

        function sortDataOldestFirst(data) {
            return [...data].sort((a, b) => {
                // Create Date objects for comparison
                const dateA = parseDateTime(a);
                const dateB = parseDateTime(b);
                return dateA - dateB; // Oldest first
            });
        }

        function parseDateTime(record) {
            const dateStr = record.Date || '';
            const timeStr = record.Time || '00:00';
            const timeOfDay = record.Timeofday || '';
            
            // Handle DD/MM/YYYY format
            if (dateStr.includes('/')) {
                const [day, month, year] = dateStr.split('/');
                const dateFormatted = `${year}-${month}-${day}`;
                const timeFormatted = fixTimeFormat(timeStr, timeOfDay);
                return new Date(`${dateFormatted}T${timeFormatted}:00`);
            }
            
            // Handle other formats
            const timeFormatted = fixTimeFormat(timeStr, timeOfDay);
            return new Date(`${dateStr}T${timeFormatted}:00`);
        }

        // ============================================
        // DATA LOADING FUNCTIONS
        // ============================================
        async function loadDataFromSheets() {
            console.log('Loading data from Google Sheets...');
            tableLoader.classList.add('active');
            recordCount.textContent = 'Loading records...';
            
            try {
                const result = await api.fetchAllData();
                
                if (result.success) {
                    gridData = result.records;
                    console.log(`Loaded ${gridData.length} records from Google Sheets`);
                    
                    // Fix time formats in all records
                    gridData.forEach(record => {
                        if (record.Time) {
                            record.Time = fixTimeFormat(record.Time, record.Timeofday);
                        }
                    });
                    
                    // Fetch real-time total from OpenSheet API
                    await fetchRealtimeTotal();
                    
                    // Update the table with ALL data (OLDEST FIRST)
                    updateDataTable();
                    
                    // Update charts
                    updateCharts();
                    
                    // Update dashboard stats - FIXED CALCULATIONS
                    updateDashboardStats();
                    
                    // NEW: Update analytics
                    updateAnalytics();
                    
                    // Update record count
                    recordCount.textContent = `Showing ${gridData.length} records from Google Sheets`;
                    
                    // Show success message
                    showNotification(`‚úÖ Loaded ${gridData.length} records from Google Sheets`, 'success');
                    
                } else {
                    throw new Error(result.message || 'Failed to load data from Google Sheets');
                }
                
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification(`‚ùå Error: ${error.message}`, 'error');
                recordCount.textContent = 'Error loading data. Please try again.';
                
                // Show empty state
                gridDataBody.innerHTML = `
                    <tr>
                        <td colspan="16" style="text-align: center; padding: 2rem;">
                            <p style="color: var(--danger);">Failed to load data from Google Sheets</p>
                            <p style="color: var(--gray); font-size: 0.8rem;">Check console for details</p>
                            <button class="btn-primary" onclick="loadDataFromSheets()" style="margin-top: 1rem;">
                                <i class="fas fa-redo"></i> Retry
                            </button>
                        </td>
                    </tr>
                `;
            } finally {
                tableLoader.classList.remove('active');
            }
        }

        // ============================================
        // FIND LATEST RECORD FUNCTION
        // ============================================
        function findLatestRecord() {
            if (gridData.length === 0) return null;
            
            const sortedByDate = sortDataNewestFirst(gridData);
            return sortedByDate[0];
        }

        // ============================================
        // UPDATE FUNCTIONS
        // ============================================
        function updateDataTable() {
            gridDataBody.innerHTML = '';
            
            if (gridData.length === 0) {
                gridDataBody.innerHTML = `
                    <tr>
                        <td colspan="16" style="text-align: center; padding: 2rem;">
                            <p style="color: var(--gray);">No data available in Google Sheets</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort data by date and time (OLDEST FIRST for table)
            const sortedDataForTable = sortDataOldestFirst(gridData);
            
            // Find peak value for highlighting
            const peakValue = Math.max(...gridData.map(row => parseInt(row.Total) || 0));
            
            // Show ALL data (no limit)
            sortedDataForTable.forEach(row => {
                const tr = document.createElement('tr');
                const total = parseInt(row.Total) || 0;
                
                // Highlight rows with very low grid totals
                if (total < 1000) {
                    tr.classList.add('low-grid');
                }
                
                // Highlight peak rows
                if (total === peakValue && peakValue > 0) {
                    tr.classList.add('peak-grid');
                }
                
                // Format date and time properly
                const displayDate = formatDateForDisplay(row.Date);
                const displayTime = fixTimeFormat(row.Time, row.Timeofday);
                
                tr.innerHTML = `
                    <td>${displayDate}</td>
                    <td>${displayTime}</td>
                    <td>${formatNumber(row.AbuyaDisCo || row.AbujaDisCo)}</td>
                    <td>${formatNumber(row.EkoDisCo)}</td>
                    <td>${formatNumber(row.IkejaDisCo)}</td>
                    <td>${formatNumber(row.IbadanDisCo)}</td>
                    <td>${formatNumber(row.BeninDisCo)}</td>
                    <td>${formatNumber(row.EnuguDisCo)}</td>
                    <td>${formatNumber(row.PHarcourtDisCo)}</td>
                    <td>${formatNumber(row.KadunaDisCo)}</td>
                    <td>${formatNumber(row.JosDisCo)}</td>
                    <td>${formatNumber(row.YolaDisCo)}</td>
                    <td>${formatNumber(row.KanoDisCo)}</td>
                    <td><strong>${formatNumber(total)}</strong></td>
                    <td>${row.Timeofday || ''}</td>
                    <td>${row.Grid_status || ''}</td>
                `;
                
                gridDataBody.appendChild(tr);
            });
            
            // Scroll to bottom of table to show newest data
            setTimeout(() => {
                tableContainer.scrollTop = tableContainer.scrollHeight;
            }, 100);
        }

        function updateCharts() {
            if (gridData.length === 0) return;
            
            // For charts, we want OLDEST FIRST for chronological order
            const sortedDataForChart = sortDataOldestFirst(gridData);
            
            // Show last 15 records for chart readability
            const chartCount = Math.min(15, sortedDataForChart.length);
            const chartData = sortedDataForChart.slice(-chartCount);
            
            // Format labels properly for chart
            const labels = chartData.map(row => {
                const date = formatDateForDisplay(row.Date);
                const time = fixTimeFormat(row.Time, row.Timeofday);
                return window.innerWidth < 768 ? `${date}\n${time}` : `${date} ${time}`;
            });
            
            const totals = chartData.map(row => parseInt(row.Total) || 0);
            
            // Get LATEST disco distribution
            const latestData = findLatestRecord();
            
            if (!latestData) {
                console.error('No latest data found for disco chart');
                return;
            }
            
            console.log('Using latest data for disco chart:', latestData);
            
            const discoLabels = ['Abuja', 'Eko', 'Ikeja', 'Ibadan', 'Benin', 'Enugu', 'PH', 'Kaduna', 'Jos', 'Yola', 'Kano'];
            const discoValues = [
                getAbujaValue(latestData),
                parseInt(latestData.EkoDisCo) || 0,
                parseInt(latestData.IkejaDisCo) || 0,
                parseInt(latestData.IbadanDisCo) || 0,
                parseInt(latestData.BeninDisCo) || 0,
                parseInt(latestData.EnuguDisCo) || 0,
                parseInt(latestData.PHarcourtDisCo) || 0,
                parseInt(latestData.KadunaDisCo) || 0,
                parseInt(latestData.JosDisCo) || 0,
                parseInt(latestData.YolaDisCo) || 0,
                parseInt(latestData.KanoDisCo) || 0
            ];
            
            // Grid Load Over Time Chart
            const loadCtx = document.getElementById('loadChart').getContext('2d');
            
            if (loadChart) {
                loadChart.destroy();
            }
            
            loadChart = new Chart(loadCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Grid Load (MW)',
                        data: totals,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: window.innerWidth < 768 ? 9 : 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Load: ${formatNumber(context.raw)} MW`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 10
                                },
                                callback: function(value) {
                                    return formatNumber(value);
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 7 : 9
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
            
            // Latest DisCo Distribution Chart
            const discoCtx = document.getElementById('discoChart').getContext('2d');
            
            if (discoChart) {
                discoChart.destroy();
            }
            
            discoChart = new Chart(discoCtx, {
                type: 'bar',
                data: {
                    labels: discoLabels,
                    datasets: [{
                        label: 'Latest Load (MW)',
                        data: discoValues,
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
                            '#ec4899', '#06b6d4', '#84cc16', '#f97316', '#6366f1', '#14b8a6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = discoValues.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((context.raw / total) * 100).toFixed(1) : 0;
                                    return `${context.label}: ${formatNumber(context.raw)} MW (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'MW',
                                font: {
                                    size: window.innerWidth < 768 ? 9 : 11
                                }
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 10
                                },
                                callback: function(value) {
                                    return formatNumber(value);
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 7 : 9
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // UPDATED DASHBOARD STATS FUNCTION - FIXED
        // ============================================
        function updateDashboardStats() {
            console.log('Updating dashboard stats with gridData:', gridData);
            
            if (gridData.length === 0) {
                currentTotal.textContent = 'No Data';
                lastUpdated.textContent = 'Last updated: Never';
                gridStatusValue.textContent = 'No Data';
                gridTrend.textContent = 'No Data';
                peakLoad.textContent = 'No Data';
                averageLoad.textContent = 'No Data';
                return;
            }
            
            // Find the latest record
            const latestData = findLatestRecord();
            
            if (!latestData) {
                console.error('No latest data found for dashboard stats');
                currentTotal.textContent = 'No Data';
                lastUpdated.textContent = 'Last updated: Never';
                gridStatusValue.textContent = 'No Data';
                gridTrend.textContent = 'No Data';
                peakLoad.textContent = 'No Data';
                averageLoad.textContent = 'No Data';
                return;
            }
            
            console.log('Latest data found:', latestData);
            
            const latestTotal = realtimeTotal; // Use real-time value from OpenSheet API
            
            // Format date and time properly for display
            const displayDate = formatDateForDisplay(latestData.Date);
            const displayTime = fixTimeFormat(latestData.Time, latestData.Timeofday);
            const latestDateTimeDisplay = `${displayDate} ${displayTime}`;
            
            // Get current system time for last updated
            const now = new Date();
            const currentDate = `${String(now.getDate()).padStart(2, '0')}/${String(now.getMonth() + 1).padStart(2, '0')}/${now.getFullYear()}`;
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            // Update current total and last updated
            currentTotal.textContent = `${formatNumber(latestTotal)} MW`;
            lastUpdated.textContent = `Last updated: ${currentDate} ${currentTime}`;
            
            // CURRENT GRID STATUS: Show the latest total
            gridStatusValue.textContent = `${formatNumber(latestTotal)} MW`;
            
            // AVERAGE PER DISCO: SIMPLE CALCULATION - Total √∑ 11 DisCos
            const averagePerDisCo = Math.round(latestTotal / 11);
            averageLoad.textContent = `${formatNumber(averagePerDisCo)} MW`;
            averageTrend.textContent = 'Per DisCo';
            averageTrend.className = 'status-trend';
            
            // PEAK LOAD TODAY: Find highest total for today
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            
            // Convert today's date to DD/MM/YYYY format for comparison
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const todayFormatted = `${day}/${month}/${year}`;
            
            console.log('Looking for data from today:', todayFormatted);
            
            const todayData = gridData.filter(row => {
                const rowDate = formatDateForDisplay(row.Date);
                console.log('Row date:', rowDate, 'Matches today?', rowDate === todayFormatted);
                return rowDate === todayFormatted;
            });
            
            console.log('Data from today:', todayData);
            
            let todayPeak = 0;
            
            if (todayData.length > 0) {
                // Calculate peak for today (highest total)
                todayPeak = Math.max(...todayData.map(row => parseInt(row.Total) || 0));
                console.log('Peak for today:', todayPeak);
            } else {
                // If no data for today, use overall peak
                todayPeak = Math.max(...gridData.map(row => parseInt(row.Total) || 0));
                console.log('Using overall peak:', todayPeak);
            }
            
            peakLoad.textContent = `${formatNumber(todayPeak)} MW`;
            
            // Determine grid trend (compare latest with previous)
            const allSortedByDate = sortDataNewestFirst(gridData);
            
            if (allSortedByDate.length >= 2) {
                const prevData = allSortedByDate[1];
                const prevTotal = parseInt(prevData.Total) || 0;
                
                if (latestTotal > prevTotal + 100) {
                    gridTrend.textContent = 'Increasing ‚Üë';
                    gridTrend.className = 'status-trend up';
                } else if (latestTotal < prevTotal - 100) {
                    gridTrend.textContent = 'Decreasing ‚Üì';
                    gridTrend.className = 'status-trend down';
                } else {
                    gridTrend.textContent = 'Stable ‚Üí';
                    gridTrend.className = 'status-trend';
                }
            } else {
                gridTrend.textContent = 'Single reading';
                gridTrend.className = 'status-trend';
            }
            
            console.log('Dashboard stats updated:');
            console.log('- Current Total:', latestTotal);
            console.log('- Average per DisCo:', averagePerDisCo);
            console.log('- Peak Today:', todayPeak);
            
            // ADDED: Update FAQ fields and status indicator
            updateFAQFields(latestData, latestTotal, currentDate, currentTime);
            updateGridStatusIndicator(latestTotal, allSortedByDate);
        }

        // ============================================
        // ADDED: FAQ Fields Update Function
        // ============================================
        function updateFAQFields(latestData, latestTotal, displayDate, displayTime) {
            if (faqTotal) {
                faqTotal.textContent = `${formatNumber(latestTotal)} MW`;
            }
            if (faqTime) {
                faqTime.textContent = `${displayDate} ${displayTime}`;
            }
            
            // Determine collapse status for FAQ
            let collapseStatus = 'No';
            if (gridData.length >= 2) {
                const sorted = sortDataNewestFirst(gridData);
                let morningTotal = null;
                let eveningTotal = null;
                
                for (let i = 0; i < Math.min(5, sorted.length); i++) {
                    const record = sorted[i];
                    if (record.Timeofday === 'Morning' && morningTotal === null) {
                        morningTotal = parseInt(record.Total) || 0;
                    } else if (record.Timeofday === 'Evening' && eveningTotal === null) {
                        eveningTotal = parseInt(record.Total) || 0;
                    }
                }
                
                if (morningTotal === 0 && eveningTotal === 0) {
                    collapseStatus = 'Yes (sustained 0MW)';
                }
            }
            
            if (faqCollapse) {
                faqCollapse.textContent = collapseStatus;
            }
        }

        // ============================================
        // ADDED: Grid Status Indicator Update
        // ============================================
        function updateGridStatusIndicator(latestTotal, sortedData) {
            // Hide all badges first
            if (statusBadge) statusBadge.style.display = 'none';
            if (statusBadgeWeak) statusBadgeWeak.style.display = 'none';
            if (statusBadgeCollapse) statusBadgeCollapse.style.display = 'none';
            
            // Check for collapse first (both morning and evening 0MW)
            let isCollapse = false;
            if (gridData.length >= 2) {
                let morningTotal = null;
                let eveningTotal = null;
                
                for (let i = 0; i < Math.min(5, sortedData.length); i++) {
                    const record = sortedData[i];
                    if (record.Timeofday === 'Morning' && morningTotal === null) {
                        morningTotal = parseInt(record.Total) || 0;
                    } else if (record.Timeofday === 'Evening' && eveningTotal === null) {
                        eveningTotal = parseInt(record.Total) || 0;
                    }
                }
                
                isCollapse = (morningTotal === 0 && eveningTotal === 0);
            }
            
            if (isCollapse) {
                if (statusBadgeCollapse) statusBadgeCollapse.style.display = 'inline-flex';
            } else if (latestTotal < 1000) {
                if (statusBadgeWeak) statusBadgeWeak.style.display = 'inline-flex';
            } else {
                if (statusBadge) statusBadge.style.display = 'inline-flex';
            }
        }

        // ============================================
        // NEW: POPULATE DISCO SELECTORS
        // ============================================
        function populateDiscoSelectors() {
            DISCO_NAMES.forEach(disco => {
                const option1 = document.createElement('option');
                option1.value = disco;
                option1.textContent = disco === 'PHarcourt' ? 'Port Harcourt DisCo' : disco + ' DisCo';
                discoTrendSelector.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = disco;
                option2.textContent = disco === 'PHarcourt' ? 'Port Harcourt DisCo' : disco + ' DisCo';
                discoRangeSelector.appendChild(option2);
            });
        }

        // ============================================
        // NEW: ANALYTICS FUNCTIONS
        // ============================================
        function updateAnalytics() {
            if (gridData.length < 2) return;

            updateDayOnDayComparison();
            updateCapacityUtilization();
        }

        function updateDayOnDayComparison() {
            const sortedData = sortDataNewestFirst(gridData);
            const latestReading = sortedData[0];
            const latestTotal = parseInt(latestReading.Total) || 0;
            const latestDate = parseDateTime(latestReading);

            // Find previous day's reading
            let previousDayTotal = null;
            for (let i = 1; i < sortedData.length; i++) {
                const currentDate = parseDateTime(sortedData[i]);
                const daysDiff = Math.floor((latestDate - currentDate) / (1000 * 60 * 60 * 24));
                
                if (daysDiff >= 1 && daysDiff <= 2) {
                    previousDayTotal = parseInt(sortedData[i].Total) || 0;
                    break;
                }
            }

            if (previousDayTotal !== null) {
                const change = latestTotal - previousDayTotal;
                const percentChange = previousDayTotal > 0 ? ((change / previousDayTotal) * 100).toFixed(1) : 0;

                dodChange.textContent = `${change >= 0 ? '+' : ''}${formatNumber(change)} MW`;
                dodSubtext.textContent = `Previous day: ${formatNumber(previousDayTotal)} MW | Current: ${formatNumber(latestTotal)} MW`;
                
                dodBadge.style.display = 'inline-flex';
                dodPercentage.textContent = `${change >= 0 ? '+' : ''}${percentChange}%`;
                
                if (change > 0) {
                    dodBadge.className = 'comparison-badge positive';
                    dodBadge.querySelector('i').className = 'fas fa-arrow-up';
                } else if (change < 0) {
                    dodBadge.className = 'comparison-badge negative';
                    dodBadge.querySelector('i').className = 'fas fa-arrow-down';
                } else {
                    dodBadge.className = 'comparison-badge neutral';
                    dodBadge.querySelector('i').className = 'fas fa-minus';
                }
            } else {
                dodChange.textContent = 'Insufficient data';
                dodSubtext.textContent = 'Need at least 2 days of readings';
                dodBadge.style.display = 'none';
            }
        }

        function updateCapacityUtilization() {
            const sortedData = sortDataNewestFirst(gridData);
            const latestTotal = realtimeTotal > 0 ? realtimeTotal : (parseInt(sortedData[0].Total) || 0);
            
            const utilizationPercent = ((latestTotal / INSTALLED_CAPACITY_MW) * 100).toFixed(1);
            
            capacityRatio.textContent = `${formatNumber(latestTotal)} / ${formatNumber(INSTALLED_CAPACITY_MW)} MW`;
            capacitySubtext.textContent = `Installed capacity based on NERC Aug 2025 data`;
            
            capacityBadge.style.display = 'inline-flex';
            capacityPercentage.textContent = `${utilizationPercent}% of capacity`;
            
            if (utilizationPercent >= 50) {
                capacityBadge.className = 'comparison-badge positive';
                capacityBadge.querySelector('i').className = 'fas fa-check-circle';
            } else if (utilizationPercent >= 30) {
                capacityBadge.className = 'comparison-badge neutral';
                capacityBadge.querySelector('i').className = 'fas fa-exclamation-circle';
            } else {
                capacityBadge.className = 'comparison-badge negative';
                capacityBadge.querySelector('i').className = 'fas fa-times-circle';
            }
        }

        // ============================================
        // NEW: DISCO TRENDLINE CHART
        // ============================================
        function updateDiscoTrendChart() {
            const selectedDisco = discoTrendSelector.value;
            
            if (!selectedDisco) {
                if (discoTrendChart) {
                    discoTrendChart.destroy();
                    discoTrendChart = null;
                }
                return;
            }

            const sortedData = sortDataNewestFirst(gridData);
            const last12 = sortedData.slice(0, 12).reverse();
            
            const labels = last12.map(row => {
                const date = formatDateForDisplay(row.Date);
                const time = fixTimeFormat(row.Time, row.Timeofday);
                return `${date} ${time}`;
            });
            
            // Special handling for Abuja (field name varies)
            let values;
            if (selectedDisco === 'Abuja') {
                values = last12.map(row => getAbujaValue(row));
                console.log(`Abuja values:`, values);
            } else {
                const fieldName = DISCO_FIELD_MAP[selectedDisco];
                values = last12.map(row => {
                    const val = parseInt(row[fieldName]) || 0;
                    return val;
                });
                console.log(`${selectedDisco} values:`, values);
            }
            
            const ctx = document.getElementById('disco-trend-chart').getContext('2d');
            
            if (discoTrendChart) {
                discoTrendChart.destroy();
            }
            
            discoTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${selectedDisco === 'PHarcourt' ? 'Port Harcourt' : selectedDisco} DisCo (MW)`,
                        data: values,
                        borderColor: 'rgb(16, 185, 129)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: 'rgb(16, 185, 129)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: window.innerWidth < 768 ? 10 : 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return selectedDisco + ': ' + formatNumber(context.parsed.y) + ' MW';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 10
                                },
                                callback: function(value) {
                                    return formatNumber(value) + ' MW';
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: {
                                    size: window.innerWidth < 768 ? 7 : 9
                                }
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // NEW: DISCO MIN/MAX RANGE CHART
        // ============================================
        function updateDiscoRangeChart() {
            const selectedDisco = discoRangeSelector.value;
            
            if (!selectedDisco) {
                if (discoRangeChart) {
                    discoRangeChart.destroy();
                    discoRangeChart = null;
                }
                return;
            }

            // Special handling for Abuja (field name varies)
            let allValues;
            if (selectedDisco === 'Abuja') {
                allValues = gridData
                    .map(row => getAbujaValue(row))
                    .filter(val => val > 0);
                console.log(`Abuja non-zero values count: ${allValues.length}`);
            } else {
                const fieldName = DISCO_FIELD_MAP[selectedDisco];
                allValues = gridData
                    .map(row => parseInt(row[fieldName]) || 0)
                    .filter(val => val > 0);
                console.log(`${selectedDisco} non-zero values count: ${allValues.length}`);
            }
            
            if (allValues.length === 0) {
                console.log(`No data found for ${selectedDisco}`);
                if (discoRangeChart) {
                    discoRangeChart.destroy();
                    discoRangeChart = null;
                }
                return;
            }

            const minValue = Math.min(...allValues);
            const maxValue = Math.max(...allValues);
            
            // Get current value
            const latestRecord = sortDataNewestFirst(gridData)[0];
            const currentValue = selectedDisco === 'Abuja' ? getAbujaValue(latestRecord) : (parseInt(latestRecord[DISCO_FIELD_MAP[selectedDisco]]) || 0);
            
            console.log(`Range for ${selectedDisco}: Min=${minValue}, Current=${currentValue}, Max=${maxValue}`);
            
            const ctx = document.getElementById('disco-range-chart').getContext('2d');
            
            if (discoRangeChart) {
                discoRangeChart.destroy();
            }
            
            discoRangeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Minimum', 'Current', 'Maximum'],
                    datasets: [{
                        label: `${selectedDisco === 'PHarcourt' ? 'Port Harcourt' : selectedDisco} DisCo (MW)`,
                        data: [minValue, currentValue, maxValue],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',   // Red for minimum
                            'rgba(59, 130, 246, 0.8)',  // Blue for current
                            'rgba(16, 185, 129, 0.8)'   // Green for maximum
                        ],
                        borderColor: [
                            'rgb(239, 68, 68)',
                            'rgb(59, 130, 246)',
                            'rgb(16, 185, 129)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + formatNumber(context.parsed.x) + ' MW';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 10
                                },
                                callback: function(value) {
                                    return formatNumber(value) + ' MW';
                                }
                            }
                        },
                        y: {
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 9 : 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // NEW: SHARE BUTTONS SETUP WITH FALLBACKS
        // ============================================
        function setupShareButtons() {
            const shareNative = document.getElementById('share-native');
            const shareTwitter = document.getElementById('share-twitter');
            const shareFacebook = document.getElementById('share-facebook');
            const shareWhatsapp = document.getElementById('share-whatsapp');
            const shareLinkedin = document.getElementById('share-linkedin');
            const shareCopy = document.getElementById('share-copy');
            
            const pageUrl = 'https://cryptonian0xx.github.io/DiscoWatchNG/';
            const shareText = 'Check Nigeria\'s live grid status on DiscoWatchNG - Is there light today?';
            const shareTitle = 'DiscoWatchNG - Nigeria Grid Status';
            
            // Check if Web Share API is available (better for mobile)
            if (navigator.share !== undefined) {
                // Show native share button on supported devices
                shareNative.style.display = 'flex';
                
                shareNative.addEventListener('click', () => {
                    navigator.share({
                        title: shareTitle,
                        text: shareText,
                        url: pageUrl
                    }).then(() => {
                        showNotification('‚úÖ Shared successfully!', 'success');
                    }).catch((error) => {
                        console.log('Native share cancelled or failed:', error);
                    });
                });
            }
            
            shareTwitter.addEventListener('click', () => {
                // Use twitter.com instead of x.com for better compatibility
                const twitterText = `${shareText} ${pageUrl}`;
                const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(twitterText)}`;
                
                // Open in new window with fallback
                safeOpenURL(twitterUrl, 'Twitter');
            });
            
            shareFacebook.addEventListener('click', () => {
                // Facebook sharer works without app
                const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}&quote=${encodeURIComponent(shareText)}`;
                
                safeOpenURL(facebookUrl, 'Facebook');
            });
            
            shareWhatsapp.addEventListener('click', () => {
                // Use web.whatsapp.com as fallback - works on desktop and mobile browsers
                const whatsappText = `${shareText} ${pageUrl}`;
                
                // Try native app first on mobile, with web fallback
                if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    // Mobile - try app with quick fallback to web
                    const appUrl = `whatsapp://send?text=${encodeURIComponent(whatsappText)}`;
                    const webUrl = `https://web.whatsapp.com/send?text=${encodeURIComponent(whatsappText)}`;
                    
                    // Try app, fallback to web after short delay
                    const start = Date.now();
                    window.location.href = appUrl;
                    
                    setTimeout(() => {
                        // If still on page after 1 second, app didn't open
                        if (Date.now() - start < 1500) {
                            window.open(webUrl, '_blank');
                        }
                    }, 1000);
                } else {
                    // Desktop - use web.whatsapp.com directly
                    const webUrl = `https://web.whatsapp.com/send?text=${encodeURIComponent(whatsappText)}`;
                    window.open(webUrl, '_blank');
                }
            });
            
            shareLinkedin.addEventListener('click', () => {
                // LinkedIn share works reliably in browser
                const linkedinUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(pageUrl)}`;
                
                safeOpenURL(linkedinUrl, 'LinkedIn');
            });
            
            shareCopy.addEventListener('click', () => {
                // Copy to clipboard with visual feedback
                const textToCopy = `${shareText}\n${pageUrl}`;
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showNotification('‚úÖ Link copied to clipboard! Share it anywhere.', 'success');
                    }).catch(() => {
                        fallbackCopyToClipboard(textToCopy);
                    });
                } else {
                    fallbackCopyToClipboard(textToCopy);
                }
            });
            
            // Helper function to safely open URLs with fallback
            function safeOpenURL(url, platformName) {
                try {
                    const newWindow = window.open(url, '_blank', 'noopener,noreferrer');
                    
                    // Check if popup was blocked
                    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                        // Popup blocked - try direct navigation
                        showNotification(`Opening ${platformName}...`, 'info');
                        setTimeout(() => {
                            window.location.href = url;
                        }, 500);
                    }
                } catch (error) {
                    console.error(`Error opening ${platformName}:`, error);
                    showNotification(`Could not open ${platformName}. Please try copying the link instead.`, 'error');
                }
            }
            
            // Fallback copy function for older browsers
            function fallbackCopyToClipboard(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    showNotification('‚úÖ Link copied to clipboard!', 'success');
                } catch (err) {
                    showNotification('‚ùå Could not copy. Please copy manually: ' + text, 'error');
                }
                
                document.body.removeChild(textArea);
            }
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function formatNumber(num) {
            const n = parseInt(num || 0);
            return n.toLocaleString('en-US');
        }

        function showNotification(message, type = 'info') {
            // Remove any existing notification
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
                <button class="notification-close"><i class="fas fa-times"></i></button>
            `;
            
            // Add close button event
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
            
            // Add to page
            document.body.appendChild(notification);
        }

        // ============================================
        // RESPONSIVE CHART UPDATES
        // ============================================
        window.addEventListener('resize', function() {
            if (gridData.length > 0) {
                updateCharts();
                if (discoTrendSelector.value) updateDiscoTrendChart();
                if (discoRangeSelector.value) updateDiscoRangeChart();
            }
        });
    </script>
</body>
</html>
